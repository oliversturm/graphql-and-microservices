using System;
using System.IO;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Collections.Generic;
using System.Linq;

namespace netcore_server
{
    public class Country
    {
        // Behold the stupidity of the C# 8.0 null value handling.
        // https://praeclarum.org/2018/12/17/nullable-reference-types.html
        // It requires me to make my code waste time by initializing 
        // a value that doesn't need to be initialized.
        // Let's hope at least the compiler realizes that this may be 
        // unnecessary.
        public string name { get; set; } = String.Empty;
        public int areaKM2 { get; set; }
        public int population { get; set; }

        // Calculated field
        public float areaPerPerson { get; set; }
    }

    public class Query
    {
        public Query() {
            countries = JsonSerializer.Deserialize<List<Country>>(json);
        }

        private List<Country> countries;
        
        public List<Country> Countries(string[]? searchNames) => 
            CalcFields(searchNames != null ? 
                countries.Where(
                    c => searchNames.Any(sn => c.name.Contains(
                        sn, StringComparison.CurrentCultureIgnoreCase))).ToList()
                : countries);

        List<Country> CalcFields(List<Country> source) {
            foreach(var c in source) 
                c.areaPerPerson = (float)c.areaKM2 / (float) c.population;
            return source;
        } 

        private string json = @"
        [{ ""name"":""American Samoa"",""areaKM2"":199,""population"":57880},
{ ""name"":""Afghanistan"",""areaKM2"":647500,""population"":29929000},
{ ""name"":""Andorra"",""areaKM2"":468,""population"":70550},
{ ""name"":""Angola"",""areaKM2"":1246700,""population"":11190800},
{ ""name"":""Anguilla"",""areaKM2"":102,""population"":13250},
{ ""name"":""Antigua \u0026 Barbuda"",""areaKM2"":443,""population"":68720},
{ ""name"":""Argentina"",""areaKM2"":2766890,""population"":39537900},
{ ""name"":""Algeria"",""areaKM2"":2381740,""population"":32531900},
{ ""name"":""Australia"",""areaKM2"":7686850,""population"":20090400},
{ ""name"":""Aruba"",""areaKM2"":193,""population"":71570},
{ ""name"":""Austria"",""areaKM2"":83858,""population"":8184700},
{ ""name"":""Azerbaijan"",""areaKM2"":86600,""population"":7912000},
{ ""name"":""Bahamas"",""areaKM2"":13940,""population"":301800},
{ ""name"":""Bahrain"",""areaKM2"":665,""population"":688300},
{ ""name"":""Bangladesh"",""areaKM2"":144000,""population"":144319600},
{ ""name"":""Belarus"",""areaKM2"":207600,""population"":10300500},
{ ""name"":""Belgium"",""areaKM2"":30510,""population"":10364400},
{ ""name"":""Belize"",""areaKM2"":22966,""population"":279500},
  { ""name"": ""Benin"", ""areaKM2"": 112620, ""population"": 7460000 },
{ ""name"":""Bermuda"",""areaKM2"":53,""population"":65370},
{ ""name"":""Armenia"",""areaKM2"":29800,""population"":2982900},
{ ""name"":""Bhutan"",""areaKM2"":47000,""population"":2232300},
{ ""name"":""Barbados"",""areaKM2"":431,""population"":279300},
{ ""name"":""Albania"",""areaKM2"":28748,""population"":3563100},
{ ""name"":""Bosnia \u0026 Herzegovina"",""areaKM2"":51129,""population"":4025500},
{ ""name"":""Brazil"",""areaKM2"":8511965,""population"":186112800},
{ ""name"":""British Virgin Islands"",""areaKM2"":153,""population"":22640},
{ ""name"":""Bulgaria"",""areaKM2"":110910,""population"":7450300},
{ ""name"":""Brunei"",""areaKM2"":5770,""population"":372400},
{ ""name"":""Burkina Faso"",""areaKM2"":274200,""population"":13925300},
{ ""name"":""Burundi"",""areaKM2"":27830,""population"":6370600},
{ ""name"":""Botswana"",""areaKM2"":600370,""population"":1640100},
{ ""name"":""Cameroon"",""areaKM2"":475440,""population"":16380000},
{ ""name"":""Canada"",""areaKM2"":9976140,""population"":32805000},
{ ""name"":""Cape Verde"",""areaKM2"":4033,""population"":418200},
{ ""name"":""Cayman Islands"",""areaKM2"":262,""population"":44270},
{ ""name"":""Central African Republic"",""areaKM2"":622984,""population"":3799900},
{ ""name"":""Chad"",""areaKM2"":1284000,""population"":9826400},
{ ""name"":""Chile"",""areaKM2"":756950,""population"":15980900},
{ ""name"":""Colombia"",""areaKM2"":1138910,""population"":42954300},
{ ""name"":""Comoros"",""areaKM2"":2170,""population"":671200},
{ ""name"":""Congo (Dem. Rep.)"",""areaKM2"":2345410,""population"":60085800},
{ ""name"":""Congo (Rep.)"",""areaKM2"":342000,""population"":3039100},
{ ""name"":""Bolivia"",""areaKM2"":1098580,""population"":8857900},
{ ""name"":""Cook Islands"",""areaKM2"":240,""population"":21390},
{ ""name"":""Costa Rica"",""areaKM2"":51100,""population"":4016200},
{ ""name"":""China"",""areaKM2"":9596960,""population"":1306313800},
{ ""name"":""Cambodia"",""areaKM2"":181040,""population"":13607100},
{ ""name"":""Croatia"",""areaKM2"":56542,""population"":4495900},
{ ""name"":""Czech Republic"",""areaKM2"":78866,""population"":10241100},
{ ""name"":""Denmark"",""areaKM2"":43094,""population"":5432300},
{ ""name"":""Cyprus"",""areaKM2"":9250,""population"":780100},
{ ""name"":""Djibouti"",""areaKM2"":23000,""population"":476700},
{ ""name"":""Dominica"",""areaKM2"":754,""population"":69030},
{ ""name"":""Dominican Republic"",""areaKM2"":48730,""population"":8950000},
{ ""name"":""Ecuador"",""areaKM2"":283560,""population"":13363600},
{ ""name"":""East Timor"",""areaKM2"":15007,""population"":1040900},
{ ""name"":""Cuba"",""areaKM2"":110860,""population"":11346700},
{ ""name"":""Cote d'Ivoire"",""areaKM2"":322460,""population"":17298000},
{ ""name"":""Eritrea"",""areaKM2"":121320,""population"":4561600},
{ ""name"":""Equatorial Guinea"",""areaKM2"":28051,""population"":535900},
{ ""name"":""Estonia"",""areaKM2"":45226,""population"":1332900},
{ ""name"":""Falkland Islands"",""areaKM2"":12173,""population"":2970},
{ ""name"":""Ethiopia"",""areaKM2"":1127127,""population"":73053300},
{ ""name"":""Faroe Islands"",""areaKM2"":1399,""population"":46960},
{ ""name"":""Finland"",""areaKM2"":337030,""population"":5223400},
{ ""name"":""France"",""areaKM2"":547030,""population"":60656200},
{ ""name"":""French Guiana"",""areaKM2"":91000,""population"":195500},
{ ""name"":""French Polynesia"",""areaKM2"":4167,""population"":270500},
{ ""name"":""Gabon"",""areaKM2"":267667,""population"":1389200},
{ ""name"":""Gambia"",""areaKM2"":11300,""population"":1593300},
{ ""name"":""Fiji"",""areaKM2"":18270,""population"":893400},
{ ""name"":""El Salvador"",""areaKM2"":21040,""population"":6704900},
{ ""name"":""Egypt"",""areaKM2"":1001450,""population"":77505800},
{ ""name"":""Germany"",""areaKM2"":357021,""population"":82431400},
{ ""name"":""Gibraltar"",""areaKM2"":6,""population"":27880},
{ ""name"":""Ghana"",""areaKM2"":239460,""population"":21029900},
{ ""name"":""Greece"",""areaKM2"":131940,""population"":10668400},
{ ""name"":""Great Britain (and Northern Ireland)"",""areaKM2"":244820,""population"":60441500},
{ ""name"":""Greenland"",""areaKM2"":2166086,""population"":56380},
{ ""name"":""Grenada"",""areaKM2"":344,""population"":89500},
{ ""name"":""Georgia"",""areaKM2"":69700,""population"":4677400},
{ ""name"":""Guadeloupe"",""areaKM2"":1780,""population"":448700},
{ ""name"":""Guam"",""areaKM2"":549,""population"":168600},
{ ""name"":""Guinea"",""areaKM2"":245857,""population"":9467900},
{ ""name"":""Guinea-Bissau"",""areaKM2"":36120,""population"":1416000},
{ ""name"":""Guatemala"",""areaKM2"":108890,""population"":14655200},
{ ""name"":""Guyana"",""areaKM2"":214970,""population"":765300},
{ ""name"":""Haiti"",""areaKM2"":27750,""population"":8121600},
{ ""name"":""Hong Kong"",""areaKM2"":1092,""population"":6898700},
{ ""name"":""Honduras"",""areaKM2"":112090,""population"":6975200},
{ ""name"":""Guernsey"",""areaKM2"":78,""population"":65230},
{ ""name"":""Iceland"",""areaKM2"":103000,""population"":296700},
{ ""name"":""Hungary"",""areaKM2"":93030,""population"":10006800},
{ ""name"":""Iran"",""areaKM2"":1648000,""population"":68017900},
{ ""name"":""Indonesia"",""areaKM2"":1919440,""population"":241973900},
{ ""name"":""Iraq"",""areaKM2"":437072,""population"":26074900},
{ ""name"":""Ireland"",""areaKM2"":70280,""population"":4015700},
{ ""name"":""Israel"",""areaKM2"":20770,""population"":6276900},
{ ""name"":""Italy"",""areaKM2"":301230,""population"":58103000},
{ ""name"":""India"",""areaKM2"":3287590,""population"":1080264400},
{ ""name"":""Jordan"",""areaKM2"":92300,""population"":5759700},
{ ""name"":""Jersey"",""areaKM2"":116,""population"":90810},
{ ""name"":""Jamaica"",""areaKM2"":10991,""population"":2731800},
{ ""name"":""Kenya"",""areaKM2"":582650,""population"":33829600},
{ ""name"":""Kazakhstan"",""areaKM2"":2717300,""population"":15185800},
{ ""name"":""Kiribati"",""areaKM2"":811,""population"":103100},
{ ""name"":""Korea (South)"",""areaKM2"":98480,""population"":48422600},
{ ""name"":""Korea (North)"",""areaKM2"":120540,""population"":22912200},
{ ""name"":""Japan"",""areaKM2"":377835,""population"":127417200},
{ ""name"":""Kyrgyzstan"",""areaKM2"":198500,""population"":5146300},
{ ""name"":""Kuwait"",""areaKM2"":17820,""population"":2335600},
{ ""name"":""Laos"",""areaKM2"":236800,""population"":6217100},
{ ""name"":""Lebanon"",""areaKM2"":10400,""population"":3826000},
{ ""name"":""Lesotho"",""areaKM2"":30355,""population"":1867000},
{ ""name"":""Latvia"",""areaKM2"":64589,""population"":2290200},
{ ""name"":""Liberia"",""areaKM2"":111370,""population"":3482200},
{ ""name"":""Libya"",""areaKM2"":1759540,""population"":5765600},
{ ""name"":""Lithuania"",""areaKM2"":65200,""population"":3596600},
{ ""name"":""Liechtenstein"",""areaKM2"":160,""population"":33720},
{ ""name"":""Luxembourg"",""areaKM2"":2586,""population"":468600},
{ ""name"":""Malawi"",""areaKM2"":118480,""population"":12158900},
{ ""name"":""Macedonia"",""areaKM2"":25333,""population"":2045300},
{ ""name"":""Malaysia"",""areaKM2"":329750,""population"":23953100},
{ ""name"":""Madagascar"",""areaKM2"":587040,""population"":18040300},
{ ""name"":""Maldives"",""areaKM2"":300,""population"":349100},
{ ""name"":""Mali"",""areaKM2"":1240000,""population"":12291500},
{ ""name"":""Malta"",""areaKM2"":316,""population"":398500},
{ ""name"":""Man, Isle of"",""areaKM2"":572,""population"":75050},
{ ""name"":""Macau"",""areaKM2"":25,""population"":449200},
{ ""name"":""Mauritania"",""areaKM2"":1030700,""population"":3086900},
{ ""name"":""Martinique"",""areaKM2"":1100,""population"":432900},
{ ""name"":""Mauritius"",""areaKM2"":2040,""population"":1230600},
{ ""name"":""Mexico"",""areaKM2"":1972550,""population"":106202900},
{ ""name"":""Micronesia, Federated States of"",""areaKM2"":702,""population"":108100},
{ ""name"":""Mayotte"",""areaKM2"":374,""population"":193600},
{ ""name"":""Marshall Islands"",""areaKM2"":181,""population"":59070},
{ ""name"":""Moldova"",""areaKM2"":33843,""population"":4455400},
{ ""name"":""Monaco"",""areaKM2"":2,""population"":32410},
{ ""name"":""Mozambique"",""areaKM2"":801590,""population"":19406700},
{ ""name"":""Mongolia"",""areaKM2"":1565000,""population"":2791300},
{ ""name"":""Montserrat"",""areaKM2"":102,""population"":9340},
{ ""name"":""Namibia"",""areaKM2"":825418,""population"":2030700},
{ ""name"":""Morocco"",""areaKM2"":446550,""population"":32725800},
{ ""name"":""Nauru"",""areaKM2"":21,""population"":13050},
{ ""name"":""Nepal"",""areaKM2"":140800,""population"":27676500},
{ ""name"":""Myanmar"",""areaKM2"":678500,""population"":42909500},
{ ""name"":""Netherlands"",""areaKM2"":41526,""population"":16407500},
{ ""name"":""New Caledonia"",""areaKM2"":19060,""population"":216500},
{ ""name"":""Netherlands Antilles"",""areaKM2"":960,""population"":220000},
{ ""name"":""Nicaragua"",""areaKM2"":129494,""population"":5465100},
{ ""name"":""Nigeria"",""areaKM2"":923768,""population"":128772000},
{ ""name"":""Niue"",""areaKM2"":260,""population"":2170},
{ ""name"":""Norfolk Island"",""areaKM2"":35,""population"":1830},
{ ""name"":""Niger"",""areaKM2"":1267000,""population"":11665900},
{ ""name"":""Northern Mariana Islands"",""areaKM2"":477,""population"":80360},
{ ""name"":""Norway"",""areaKM2"":324220,""population"":4593000},
{ ""name"":""Oman"",""areaKM2"":212460,""population"":3001600},
{ ""name"":""New Zealand"",""areaKM2"":268680,""population"":4035500},
{ ""name"":""Palestinian Territories"",""areaKM2"":6220,""population"":3761900},
{ ""name"":""Panama"",""areaKM2"":78200,""population"":3039200},
{ ""name"":""Papua New Guinea"",""areaKM2"":462840,""population"":5545300},
{ ""name"":""Paraguay"",""areaKM2"":406750,""population"":6347900},
{ ""name"":""Palau"",""areaKM2"":458,""population"":20300},
{ ""name"":""Peru"",""areaKM2"":1285220,""population"":27925600},
{ ""name"":""Philippines"",""areaKM2"":300000,""population"":87857500},
{ ""name"":""Pitcairn"",""areaKM2"":47,""population"":46},
{ ""name"":""Poland"",""areaKM2"":312685,""population"":38635100},
{ ""name"":""Portugal"",""areaKM2"":92391,""population"":10566200},
{ ""name"":""Pakistan"",""areaKM2"":803940,""population"":162419900},
{ ""name"":""Reunion"",""areaKM2"":2517,""population"":776900},
{ ""name"":""Russia"",""areaKM2"":17075200,""population"":143420300},
{ ""name"":""Romania"",""areaKM2"":237500,""population"":22330000},
{ ""name"":""Qatar"",""areaKM2"":11437,""population"":863100},
{ ""name"":""Rwanda"",""areaKM2"":26338,""population"":8440800},
{ ""name"":""Saint Helena"",""areaKM2"":410,""population"":7460},
{ ""name"":""Puerto Rico"",""areaKM2"":9104,""population"":3916600},
{ ""name"":""Saint Kitts \u0026 Nevis"",""areaKM2"":261,""population"":38960},
{ ""name"":""Saint Pierre \u0026 Miquelon"",""areaKM2"":242,""population"":7010},
{ ""name"":""Saint Lucia"",""areaKM2"":616,""population"":166300},
{ ""name"":""Samoa"",""areaKM2"":2944,""population"":177300},
{ ""name"":""San Marino"",""areaKM2"":61,""population"":28880},
{ ""name"":""Sao Tome \u0026 Principe"",""areaKM2"":1001,""population"":187400},
{ ""name"":""Saudi Arabia"",""areaKM2"":1960582,""population"":26417600},
{ ""name"":""Senegal"",""areaKM2"":196190,""population"":11126800},
{ ""name"":""Serbia \u0026 Montenegro"",""areaKM2"":102350,""population"":10829200},
{ ""name"":""Saint Vincent (\u0026 the Grenadines)"",""areaKM2"":389,""population"":117500},
{ ""name"":""Seychelles"",""areaKM2"":455,""population"":81190},
{ ""name"":""Sierra Leone"",""areaKM2"":71740,""population"":6017600},
{ ""name"":""Slovakia"",""areaKM2"":48845,""population"":5431400},
{ ""name"":""Solomon Islands"",""areaKM2"":28450,""population"":538000},
{ ""name"":""Slovenia"",""areaKM2"":20273,""population"":2011100},
{ ""name"":""Somalia"",""areaKM2"":637657,""population"":8591600},
{ ""name"":""South Africa"",""areaKM2"":1219912,""population"":44344100},
{ ""name"":""Spain"",""areaKM2"":504782,""population"":40341500},
{ ""name"":""Sri Lanka"",""areaKM2"":65610,""population"":20064800},
{ ""name"":""Singapore"",""areaKM2"":693,""population"":4425700},
{ ""name"":""Sudan"",""areaKM2"":2505810,""population"":40187500},
{ ""name"":""Sweden"",""areaKM2"":449964,""population"":9001800},
{ ""name"":""Swaziland"",""areaKM2"":17363,""population"":1173900},
{ ""name"":""Switzerland"",""areaKM2"":41290,""population"":7489400},
{ ""name"":""Suriname"",""areaKM2"":163270,""population"":438100},
{ ""name"":""Svalbard"",""areaKM2"":62049,""population"":2700},
{ ""name"":""Syria"",""areaKM2"":185180,""population"":18448800},
{ ""name"":""Taiwan (Republic of China)"",""areaKM2"":35980,""population"":22894400},
{ ""name"":""Tanzania"",""areaKM2"":945087,""population"":36766400},
{ ""name"":""Tajikistan"",""areaKM2"":143100,""population"":7163500},
{ ""name"":""Tonga"",""areaKM2"":748,""population"":112400},
{ ""name"":""Togo"",""areaKM2"":56785,""population"":5681500},
{ ""name"":""Thailand"",""areaKM2"":514000,""population"":65444400},
{ ""name"":""Trinidad \u0026 Tobago"",""areaKM2"":5128,""population"":1088600},
{ ""name"":""Tokelau"",""areaKM2"":10,""population"":1410},
{ ""name"":""Tunisia"",""areaKM2"":163610,""population"":10075000},
{ ""name"":""Turks \u0026 Caicos Islands"",""areaKM2"":430,""population"":20560},
{ ""name"":""Turkey"",""areaKM2"":780580,""population"":69660600},
{ ""name"":""Turkmenistan"",""areaKM2"":488100,""population"":4952100},
{ ""name"":""Uganda"",""areaKM2"":236040,""population"":27269500},
{ ""name"":""Ukraine"",""areaKM2"":603700,""population"":47425300},
{ ""name"":""United States of America"",""areaKM2"":9629091,""population"":295734100},
{ ""name"":""United Arab Emirates"",""areaKM2"":82880,""population"":2563200},
{ ""name"":""Uruguay"",""areaKM2"":176220,""population"":3415900},
{ ""name"":""Uzbekistan"",""areaKM2"":447400,""population"":26851200},
{ ""name"":""Vanuatu"",""areaKM2"":12200,""population"":205800},
{ ""name"":""Vatican City"",""areaKM2"":1,""population"":920},
{ ""name"":""Vietnam"",""areaKM2"":329560,""population"":83535600},
{ ""name"":""Tuvalu"",""areaKM2"":26,""population"":11640},
{ ""name"":""Wallis \u0026 Futuna"",""areaKM2"":274,""population"":16030},
{ ""name"":""Western Sahara"",""areaKM2"":266000,""population"":273000},
{ ""name"":""Yemen"",""areaKM2"":527970,""population"":20727100},
{ ""name"":""Venezuela"",""areaKM2"":912050,""population"":25375300},
{ ""name"":""Zambia"",""areaKM2"":752614,""population"":11261800},
{ ""name"":""Virgin Islands of the US"",""areaKM2"":352,""population"":108700},
{ ""name"":""Zimbabwe"",""areaKM2"":390580,""population"":12747000}
]
        ";
    }
}
